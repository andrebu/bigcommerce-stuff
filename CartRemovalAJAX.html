<style>
	.CartContents .CartItemQuantity {
		position: relative;
	}
	.confirm-removal-prompt {
		display: inline-block;
		width: 100%;
		height: 100px;
		position: absolute;
		background-color: #fff;
		left: 0;
		top: 0;
		z-index: 1;
		padding: 10px;
		box-sizing: border-box;
	}
	.confirm-removal-prompt span {
		font-size: 11px;
	}
	.confirm-removal-prompt .conf-btn {
		display: inline-block;
		border-radius: 50%;
		font-size: 30px;
		margin: 20px 10px 0;
	}
	.confirm-removal-prompt .conf-btn:hover {
		cursor: pointer;
	}
	.fa-check-circle {
		color: #6ada78;
	}
	.fa-times-circle {
		color: #f47d77;
	}
	.CartContents .restore-item-box {
		padding: 0;
		text-align: center;
		font-size: 12px;
		font-family: futura;
		background: #fff;
		border-bottom: 1px solid #ededed;
		border-top: 1px solid #ededed;
		z-index: 2;
	}
	.CartContents .restore-item-box > div:first-child {
		margin-top: 20px;
		margin-bottom: 10px;
	}
	.CartContents .restore-item-box i {
		font-size: 20px;
		vertical-align: middle;
		padding-right: 10px;
	}
	.restore-item-box div:nth-of-type(2) a {
		color: #39b54a;
	}
	.restore-item-box div:nth-of-type(2) a:hover {
		color: #6ada78;
	}
</style>
<script>
// Panels/CartContent.html --> <tbody>SNIPPET_CartItems%%</tbody> -- > place %%Panel.CartRemovalAJAX%% here
// Only thing left to do is to dynamically change the cart total and subtotal
	var cartTotal = $('.gtotal .ProductPrice');
	var cartQuantity = $('.header-secondary .CartLink span');
	ajaxifyCartRemoval();

	//Change the HTML 'onclick=' value to new function
	function ajaxifyCartRemoval() {
		var allCartLinks = $('a.CartRemoveLink');
		allCartLinks.each( function() {
			var removeLink = $(this).attr('href');
			var removeLinkSplit = removeLink.split('item=');
			var removeItemId = removeLinkSplit[1];
			var origItemOnclick = $(this).unbind().attr('onclick', 'newCartRemovalFunc("' + removeItemId + '", $(this)); return false;');
			$(this).attr('href', '#');
		});
	}
	function newCartRemovalFunc(globalItemId, removeAnch) {
		//Remove any prompt that is already open
		$('.confirm-removal-prompt').fadeOut().remove();

		//Add "Are you sure?" prompt with green and red button
		var thisItemQtyBox = removeAnch.parents('.CartItemQuantity');
		var confirmPrompt = '<div class="confirm-removal-prompt"><span>Are you sure you want to remove this item?</span>';
			confirmPrompt += '<i class="conf-btn fa fa-check-circle"></i><i class="conf-btn fa fa-times-circle"></i></div>';
		thisItemQtyBox.hide().append(confirmPrompt).fadeIn('slow');
		
		//Define confirmation button on-click behavior 
		var removeBtn = $('.conf-btn.fa-check-circle');
		var doNotRemoveBtn = $('.conf-btn.fa-times-circle');
			//Confirm YES button action
		removeBtn.on('click', function(e) {
			e.stopPropagation();
			
			//Get some product info
			var thisCartItem = removeAnch.parents().eq(2);
			var thisProdAnch = $('<div />').append( $(thisCartItem.find('.ProductName > a').get(0)).clone() ).html();
			var thisProdHref = thisCartItem.find('.ProductName > a').attr('href');
			var pathHolder = document.createElement('a');
			pathHolder.href = thisProdHref;
			var thisProdPathname = pathHolder.pathname;
			var thisProdThumbSrc = thisCartItem.find('.CartThumb img').attr('src');
			
			//Find item total cost
			var currentCartTotal = parseFloat(cartTotal.text().replace('$',''));
			var thisItemTotal = parseFloat(thisCartItem.find('.CartItemTotalPrice .ProductPrice').text().replace('$',''));
			var newCartTotal = (currentCartTotal - thisItemTotal);
	
			//Find current qty and find item qty and calculate what the cart-qty would be if item was removed
			var currentCartQuantity = parseInt(cartQuantity.text());
			var thisItemQuantity = parseInt(thisItemQtyBox.find('.quantityInput').val());
			var newCartQuantity = (currentCartQuantity - thisItemQuantity);
			
			//Construct the HTML for the 'Restore this item' prompt
			var restoreBoxHTML = '<div class="restore-item-box"><div><i class="conf-btn fa fa-check-circle"></i> ';
			restoreBoxHTML += thisProdAnch + ' x ' + thisItemQuantity + ' was removed from your cart</div>';
			restoreBoxHTML += '<div><a href="#" onclick=\"restoreThisItem(\'' + thisProdPathname;
			restoreBoxHTML += '\', ' + thisItemQuantity + ', ' + thisItemTotal + ', $(this)); return false;\">';
			restoreBoxHTML += 'Click here</a> to put it back in your cart</div></div>';
				//current item position and dimensions for restoreBoxHTML position
			var rowPos = thisCartItem.position();
			var thisItemTop = rowPos.top;
			var thisItemLeft = rowPos.left;
			var thisItemWidth = thisCartItem.css('width');
			var thisItemHeight = thisCartItem.css('height');
	
			$.post('https://dankstop.com/cart.php?action=remove&item=' + globalItemId + '', function() {
				var restoreContainer = $(restoreBoxHTML).css({
					    position: 'absolute',
					    top: thisItemTop,
					    left: thisItemLeft,
					    width: thisItemWidth,
					    height: thisItemHeight
					});
				$(restoreContainer).hide().appendTo(thisCartItem).fadeIn('slow');
				cartTotal.hide().html('$'+newCartTotal).fadeIn('slow'); //'$'+
				cartQuantity.hide().html(newCartQuantity).fadeIn('slow');
				$('.confirm-removal-prompt').fadeOut('slow').remove();
			});
		});
			//Confirm NO button action
		doNotRemoveBtn.on('click', function (e) {
			$('.confirm-removal-prompt').fadeOut('slow').remove();
		});
	}
	
	function restoreThisItem(prodPath, itemQty, itemTotal, thisBox) {
		var getProdIdQuery = 'https://dankstop.com' + prodPath + ' .productAddToCartRight #productDetailsAddToCartForm input[name="product_id"]'
		var currentCartTotal = parseFloat(cartTotal.text().replace('$',''));
		var restoreCartTotal = (currentCartTotal + itemTotal);		
		var currentCartQuantity = parseInt(cartQuantity.text());
		var restoreCartQuantity = (currentCartQuantity + itemQty);		
		$('<div />').load(getProdIdQuery, function(){
		    var thisProId = $(this).find('input[name="product_id"]').val();
		console.log(thisProId);
		    thisBox.parents().eq(1).fadeOut('slow');
		    $.post('https://dankstop.com/cart.php?action=add&product_id=' + thisProId + '&qty=' + itemQty + '');
			cartTotal.hide().html('$'+restoreCartTotal).fadeIn('slow');
			cartQuantity.hide().html(restoreCartQuantity).fadeIn('slow');
		});
	}
</script>